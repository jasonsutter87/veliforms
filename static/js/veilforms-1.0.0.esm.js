/*!
 * VeilForms SDK v1.0.0
 * https://veilforms.com
 * Copyright (c) 2025 VeilForms
 * Licensed under MIT
 * Built: 2025-12-13
 */
async function P(){return crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function g(e,i){let s=await crypto.subtle.importKey("jwk",i,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]),o=await P(),a=new TextEncoder().encode(JSON.stringify(e)),d=crypto.getRandomValues(new Uint8Array(12)),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:d},o,a),n=await crypto.subtle.exportKey("raw",o),t=await crypto.subtle.encrypt({name:"RSA-OAEP"},s,n);return{encrypted:!0,version:"vf-e1",data:m(c),key:m(t),iv:m(d)}}async function x(e,i=""){let o=new TextEncoder().encode(i+e.toLowerCase().trim()),f=await crypto.subtle.digest("SHA-256",o);return m(f)}function m(e){let i=new Uint8Array(e),s="";for(let o=0;o<i.byteLength;o++)s+=String.fromCharCode(i[o]);return btoa(s)}function I(e){return"vf-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){let s=crypto.getRandomValues(new Uint8Array(1))[0]%16;return(i==="x"?s:s&3|8).toString(16)})}var A={email:/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,phone:/(\+?1[-.\s]?)?(\(?\d{3}\)?[-.\s]?)?\d{3}[-.\s]?\d{4}/g,ssn:/\b\d{3}[-.\s]?\d{2}[-.\s]?\d{4}\b/g,creditCard:/\b(?:\d{4}[-.\s]?){3}\d{4}\b/g,ipv4:/\b(?:\d{1,3}\.){3}\d{1,3}\b/g,ipv6:/\b(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}\b/g,zipCode:/\b\d{5}(?:-\d{4})?\b/g,dob:/\b(?:0?[1-9]|1[0-2])[-/](?:0?[1-9]|[12]\d|3[01])[-/](?:19|20)\d{2}\b/g},v=["email","mail","e-mail","name","firstname","first_name","lastname","last_name","fullname","full_name","phone","telephone","mobile","cell","ssn","social","socialsecurity","address","street","city","state","zip","zipcode","postal","dob","birthday","birthdate","dateofbirth","creditcard","cc","cardnumber","cvv","cvc","password","pass","pwd","ip","ipaddress"];function h(e){let i={hasPII:!1,fields:[],patterns:[]};for(let[s,o]of Object.entries(e)){let f=s.toLowerCase().replace(/[-_\s]/g,"");if(v.some(a=>f.includes(a))&&(i.hasPII=!0,i.fields.push({field:s,reason:"field_name_suggests_pii"})),typeof o=="string")for(let[a,d]of Object.entries(A))d.lastIndex=0,d.test(o)&&(i.hasPII=!0,i.patterns.push({field:s,type:a}))}return i}async function S(e,i={}){let{redactionMarker:s="[REDACTED]",preserveFields:o=[],hashInsteadOfRedact:f=!1}=i,a={...e},d=[];for(let[c,n]of Object.entries(a)){if(o.includes(c))continue;let t=c.toLowerCase().replace(/[-_\s]/g,"");if(v.some(r=>t.includes(r))){f&&typeof n=="string"?a[c]=await K(n):a[c]=s,d.push(c);continue}if(typeof n=="string"){let r=n;for(let[u,p]of Object.entries(A))p.lastIndex=0,p.test(r)&&(r=r.replace(p,s),d.includes(c)||d.push(c));a[c]=r}}return{data:a,strippedFields:d,wasModified:d.length>0}}async function K(e){let s=new TextEncoder().encode(e.toLowerCase().trim()),o=await crypto.subtle.digest("SHA-256",s);return"hash:"+Array.from(new Uint8Array(o)).map(a=>a.toString(16).padStart(2,"0")).join("").substring(0,16)}var E=function(){"use strict";let e={endpoint:null,formId:null,publicKey:null,debug:!1,encryption:!0,piiWarning:!0,piiStrip:!1};function i(n,t={}){e.formId=n,e.endpoint=t.endpoint||"https://veilforms.com/api/submit",e.publicKey=t.publicKey||null,e.debug=t.debug||!1,e.encryption=t.encryption!==!1,e.piiWarning=t.piiWarning!==!1,e.piiStrip=t.piiStrip||!1,c("Initialized with form:",n),t.autoBind!==!1&&s()}function s(){document.querySelectorAll("form[data-veilform]").forEach(n=>{n.addEventListener("submit",o),c("Bound form:",n.id||n.name||"unnamed")})}async function o(n){n.preventDefault();let t=n.target;try{let l=f(t),r=await a(l,{formElement:t}),u=new CustomEvent("veilforms:success",{detail:r});t.dispatchEvent(u),t.dataset.veilformReset!=="false"&&t.reset(),c("Submission successful:",r.submissionId)}catch(l){let r=new CustomEvent("veilforms:error",{detail:{error:l.message}});t.dispatchEvent(r),c("Submission failed:",l.message)}}function f(n){let t={},l=new FormData(n);for(let[r,u]of l.entries())t[r]?Array.isArray(t[r])?t[r].push(u):t[r]=[t[r],u]:t[r]=u;return t}async function a(n,t={}){if(!e.formId)throw new Error("VeilForms not initialized. Call VeilForms.init() first.");let l={...n};if(e.piiWarning||e.piiStrip){let y=h(l);if(y.hasPII)if(e.piiStrip){let w=S(l);l=w.data,c("PII stripped from fields:",w.strippedFields)}else e.piiWarning&&console.warn("[VeilForms] PII detected in submission:",y)}let r=I(e.formId),u;e.encryption&&e.publicKey?(u=await g(l,e.publicKey),c("Data encrypted client-side")):u={encrypted:!1,data:l};let p={formId:e.formId,submissionId:r,payload:u,timestamp:Date.now(),meta:{sdk:"veilforms-js",version:"1.0.0"}},b=await fetch(e.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!b.ok){let y=await b.json().catch(()=>({}));throw new Error(y.message||`Submission failed: ${b.status}`)}return{success:!0,submissionId:r,timestamp:p.timestamp}}async function d(n,t={}){return a({_event:n,...t})}function c(...n){e.debug&&console&&console.log("[VeilForms]",...n)}return{init:i,submit:a,track:d,bindForms:s,utils:{collectFormData:f,hashField:x,detectPII:h}}}();typeof window<"u"&&(window.VeilForms=E);var N=E;export{N as default};
