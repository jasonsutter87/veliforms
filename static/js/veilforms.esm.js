async function P(){return crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function g(a,e){let r=await crypto.subtle.importKey("jwk",e,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]),s=await P(),i=new TextEncoder().encode(JSON.stringify(a)),c=crypto.getRandomValues(new Uint8Array(12)),f=await crypto.subtle.encrypt({name:"AES-GCM",iv:c},s,i),l=await crypto.subtle.exportKey("raw",s),n=await crypto.subtle.encrypt({name:"RSA-OAEP"},r,l);return{encrypted:!0,version:"vf-e1",data:m(f),key:m(n),iv:m(c)}}async function I(a,e=""){let s=new TextEncoder().encode(e+a.toLowerCase().trim()),p=await crypto.subtle.digest("SHA-256",s);return m(p)}function m(a){let e=new Uint8Array(a),r="";for(let s=0;s<e.byteLength;s++)r+=String.fromCharCode(e[s]);return btoa(r)}function v(a){return"vf-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let r=crypto.getRandomValues(new Uint8Array(1))[0]%16;return(e==="x"?r:r&3|8).toString(16)})}var A={email:/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,phone:/(\+?1[-.\s]?)?(\(?\d{3}\)?[-.\s]?)?\d{3}[-.\s]?\d{4}/g,ssn:/\b\d{3}[-.\s]?\d{2}[-.\s]?\d{4}\b/g,creditCard:/\b(?:\d{4}[-.\s]?){3}\d{4}\b/g,ipv4:/\b(?:\d{1,3}\.){3}\d{1,3}\b/g,ipv6:/\b(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}\b/g,zipCode:/\b\d{5}(?:-\d{4})?\b/g,dob:/\b(?:0?[1-9]|1[0-2])[-/](?:0?[1-9]|[12]\d|3[01])[-/](?:19|20)\d{2}\b/g},S=["email","mail","e-mail","name","firstname","first_name","lastname","last_name","fullname","full_name","phone","telephone","mobile","cell","ssn","social","socialsecurity","address","street","city","state","zip","zipcode","postal","dob","birthday","birthdate","dateofbirth","creditcard","cc","cardnumber","cvv","cvc","password","pass","pwd","ip","ipaddress"];function w(a){let e={hasPII:!1,fields:[],patterns:[]};for(let[r,s]of Object.entries(a)){let p=r.toLowerCase().replace(/[-_\s]/g,"");if(S.some(i=>p.includes(i))&&(e.hasPII=!0,e.fields.push({field:r,reason:"field_name_suggests_pii"})),typeof s=="string")for(let[i,c]of Object.entries(A))c.lastIndex=0,c.test(s)&&(e.hasPII=!0,e.patterns.push({field:r,type:i}))}return e}async function E(a,e={}){let{redactionMarker:r="[REDACTED]",preserveFields:s=[],hashInsteadOfRedact:p=!1}=e,i={...a},c=[];for(let[f,l]of Object.entries(i)){if(s.includes(f))continue;let n=f.toLowerCase().replace(/[-_\s]/g,"");if(S.some(o=>n.includes(o))){p&&typeof l=="string"?i[f]=await F(l):i[f]=r,c.push(f);continue}if(typeof l=="string"){let o=l;for(let[d,u]of Object.entries(A))u.lastIndex=0,u.test(o)&&(o=o.replace(u,r),c.includes(f)||c.push(f));i[f]=o}}return{data:i,strippedFields:c,wasModified:c.length>0}}async function F(a){let r=new TextEncoder().encode(a.toLowerCase().trim()),s=await crypto.subtle.digest("SHA-256",r);return"hash:"+Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("").substring(0,16)}var K=function(){"use strict";let a="1.0.0",e={endpoint:null,formId:null,publicKey:null,debug:!1,encryption:!0,piiWarning:!0,piiStrip:!1};function r(n,t={}){e.formId=n,e.endpoint=t.endpoint||"https://veilforms.com/api/submit",e.publicKey=t.publicKey||null,e.debug=t.debug||!1,e.encryption=t.encryption!==!1,e.piiWarning=t.piiWarning!==!1,e.piiStrip=t.piiStrip||!1,l("Initialized with form:",n),t.autoBind!==!1&&s()}function s(){document.querySelectorAll("form[data-veilform]").forEach(n=>{n.addEventListener("submit",p),l("Bound form:",n.id||n.name||"unnamed")})}async function p(n){n.preventDefault();let t=n.target;try{let o=i(t),d=await c(o,{formElement:t}),u=new CustomEvent("veilforms:success",{detail:d});t.dispatchEvent(u),t.dataset.veilformReset!=="false"&&t.reset(),l("Submission successful:",d.submissionId)}catch(o){let d=new CustomEvent("veilforms:error",{detail:{error:o.message}});t.dispatchEvent(d),l("Submission failed:",o.message)}}function i(n){let t={},o=new FormData(n);for(let[d,u]of o.entries())t[d]?Array.isArray(t[d])?t[d].push(u):t[d]=[t[d],u]:t[d]=u;return t}async function c(n,t={}){if(!e.formId)throw new Error("VeilForms not initialized. Call VeilForms.init() first.");let o={...n};if(e.piiWarning||e.piiStrip){let y=w(o);if(y.hasPII)if(e.piiStrip){let x=E(o);o=x.data,l("PII stripped from fields:",x.strippedFields)}else e.piiWarning&&console.warn("[VeilForms] PII detected in submission:",y)}let d=v(e.formId),u;e.encryption&&e.publicKey?(u=await g(o,e.publicKey),l("Data encrypted client-side")):u={encrypted:!1,data:o};let b={formId:e.formId,submissionId:d,payload:u,timestamp:Date.now(),meta:{sdk:"veilforms-js",sdkVersion:a}},h=await fetch(e.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!h.ok){let y=await h.json().catch(()=>({}));throw new Error(y.message||`Submission failed: ${h.status}`)}return{success:!0,submissionId:d,timestamp:b.timestamp}}async function f(n,t={}){return c({_event:n,...t})}function l(...n){e.debug&&console&&console.log("[VeilForms]",...n)}return{version:a,init:r,submit:c,track:f,bindForms:s,utils:{collectFormData:i,hashField:I,detectPII:w}}}();typeof window<"u"&&(window.VeilForms=K);var j=K;export{j as default};
/**
 * VeilForms Client SDK
 * Version: 1.0.0
 * Drop-in privacy-first form handler
 * Encrypts data client-side before submission
 *
 * @version 1.0.0
 * @license MIT
 * @see https://veilforms.com/docs
 */
